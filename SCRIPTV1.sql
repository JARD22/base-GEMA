CREATE TABLE CURSOS(
COD_CURSO INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
NOMBRE VARCHAR(100) NOT NULL,
DESCRIPCION VARCHAR(200) NOT NULL,
ESTADO BOOLEAN NOT NULL,
USR_REGISTRO VARCHAR(50) NOT NULL,
FEC_REGISTRO DATE NOT NULL
);

CREATE TABLE SECCIONES(
COD_SECCION GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
NOMBRE CHAR(1) NOT NULL,
CUPOS INT NOT NULL,	
ESTADO BOOLEAN NOT NULL DEFAULT TRUE,
ANIO DATE NOT NULL,
USR_REGISTRO VARCHAR(50) NOT NULL,
FEC_REGISTRO DATE NOT NULL
);

CREATE TABLE COLEGIOS(
COD_COLEGIO GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
NOMBRE VARCHAR(200) NOT NULL,
USR_REGISTRO VARCHAR(50) NOT NULL,
FEC_REGISTRO DATE NOT NULL
);

CREATE TABLE TIPO_PERSONA(
COD_TIPO_PERSONA GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
NOMBRE VARCHAR(50) NOT NULL,
DESCRIPCION VARCHAR(150) NOT NULL,
USR_REGISTRO VARCHAR(50) NOT NULL,
FEC_REGISTRO DATE NOT NULL
);

CREATE TABLE PERSONA(
COD_PERSONA GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
UID uuid NOT NULL DEFAULT uuid_generate_v1(),
COD_TIPO_PERSONA INT NOT NULL,
DNI VARCHAR(30) NOT NULL,
PRIMER_NOMBRE VARCHAR(50) NOT NULL,
SEGUNDO_NOMBRE VARCHAR(50),
PRIMER_APELLIDO VARCHAR(50) NOT NULL,
SEGUNDO_APELLIDO VARCHAR(50),
SEXO CHAR(1)NOT NULL,
FEC_NACIMIENTO DATE NOT NULL,
LUGAR_TRABAJO VARCHAR(100),
OCUPACION VARCHAR(100),
ENFERMEDAD VARCHAR(250),
USR_REGISTRO VARCHAR(50) NOT NULL,
FEC_REGISTRO DATE NOT NULL,
	
	CONSTRAINT FK_TIPO_PERSONA_PERSONA FOREIGN KEY(COD_TIPO_PERSONA) 
	REFERENCES TIPO_PERSONA(COD_TIPO_PERSONA)
);


CREATE TABLE CORREO(
COD_CORREO INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
CORREO VARCHAR(100),
USR_REGISTO VARCHAR(50) NOT NULL,
FEC_REGISTRO DATE
);

CREATE TABLE CORREO_PERSONA(
COD_COR_PER INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
COD_PERSONA INT NOT NULL
COD_CORREO INT NOT NULL,
	
	CONSTRAINT FK_CORREO_PERSONA_PERSONA FOREIGN KEY(COD_PERSONA)
	REFERENCES PERSONA(COD_PERSONA),
	
	CONSTRAINT FK_CORREO_PERSONA_CORREO FOREIGN KEY(COD_CORREO)
	REFERENCES PERSONA(COD_CORREO)
	
);


CREATE TABLE DIRECCION(
COD_DIRECCION INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
DIRECCION VARCHAR(300) NOT NULL,
USR_REGISTRO VARCHAR(50) NOT NULL,
FEC_REGISTRO DATE NOT NULL
);

CREATE TABLE DIRECCION_PERSONA(
COD_DIR_PER INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
COD_PERSONA INT NOT NULL,
COD_DIRECCION INT NOT NULL,
	
	
	CONSTRAINT FK_DIRECCION_PERSONA_PERSONA FOREIGN KEY (COD_PERSONA)
	REFERENCES PERSONA(COD_PERSONA),
	
	CONSTRAINT FK_DIRECCION_PERSONA_DIRECCION FOREIGN KEY (COD_DIRECCION)
	REFERENCES DIRECCION(COD_DIRECCION)
	
);

CREATE TABLE TIPO_TELEFONO(
COD_TIPO_TELEFONO INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
NOMBRE VARCHAR(100) NOT NULL,
DESCRIPCION VARCHAR(200) NOT NULL,
USR_REGISTRO VARCHAR(50) NOT NULL,
FEC_REGISTRO DATE NOT NULL
);

CREATE TABLE TELEFONO(
COD_TELEFONO INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
COD_TIPO_TELEFONO INT NOT NULL,
TELEFONO VARCHAR(20) NOT NULL,
WHATSAPP BOOLEAN NOT NULL DEFAULT FALSE,
USR_REGISTRO VARCHAR(50) NOT NULL,
FEC_REGISTRO DATE NOT NULL,
	
CONSTRAINT FK_TELEFONO_TIPO_TELEFONO FOREIGN KEY(COD_TIPO_TELEFONO)
	REFERENCES TIPO_TELEFONO(COD_TIPO_TELEFONO)

);

CREATE TABLE TELEFONO_PERSONA(
COD_TEL_PER INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
COD_TELEFONO INT NOT NULL,
COD_PERSONA INT NOT NULL,
	
	CONSTRAINT FK_TELEFONO_PERSONA_TELEFONO FOREIGN KEY(COD_TELEFONO)
	REFERENCES TELEFONO(COD_TELEFONO),
	
	CONSTRAINT FK_TELEFONO_PERSONA_PERSONA FOREIGN KEY(COD_PERSONA)
	REFERENCES PERSONA(COD_PERSONA)
);

CREATE TABLE MATRICULA(
COD_MATRICULA INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
COD_PERSONA INT NOT NULL,
COD_CURSO INT NOT NULL,
COD_SECCION INT NOT NULL,
ANIO DATE NOT NULL,
USR_REGISTRO VARCHAR(50) NOT NULL,
FEC_REGISTRO DATE NOT NULL,
	
	CONSTRAINT FK_MATRICULA_PERSONA FOREIGN KEY(COD_PERSONA)
	REFERENCES PERSONA(COD_PERSONA),
	
	CONSTRAINT FK_MATRICULA_CURSO FOREIGN KEY(COD_CURSO)
	REFERENCES CURSOS(COD_CURSO),
	
	CONSTRAINT FK_MATRICULA_SECCION FOREIGN KEY(COD_SECCION)
	REFERENCES SECCIONES(COD_SECCION)	
);

CREATE TABLE EXPEDIENTE(
COD_EXPEDIENTE INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
COD_PERSONA INT NOT NULL,
COD_COLEGIO INT NOT NULL,
COD_CURSO INT NOT NULL,
ANIO DATE NOT NULL,
USR_REGISTRO VARCHAR(50) NOT NULL,
FEC_REGISTRO DATE NOT NULL,
	
CONSTRAINT FK_EXPEDIENTE_PERSONA FOREIGN KEY(COD_PERSONA)
	REFERENCES PERSONA(COD_PERSONA),
	
CONSTRAINT FK_EXPEDIENTE_COLEGIO FOREIGN KEY(COD_COLEGIO)
	REFERENCES COLEGIOS(COD_COLEGIO),
	
	
CONSTRAINT FK_EXPEDIENTE_CURSOS FOREIGN KEY(COD_CURSO)
	REFERENCES CURSOS(COD_CURSO)
);

CREATE TABLE PANTALLAS(
COD_PANTALLA INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
NOMBRE VARCHAR(75) NOT NULL,
URL VARCHAR(35) NOT NULL,
CHECK_PANTALLA VARCHAR(35) NOT NULL,
ESTADO BOOLEAN NOT NULL DEFAULT TRUE,
USR_REGISTRO VARCHAR(50) NOT NULL, 
FEC_REGISTRO DATE NOT NULL
);

CREATE TABLE ROLES(
COD_ROL INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
NOMBRE VARCHAR(20) NOT NULL,
DESCRIPCION VARCHAR(250) NOT NULL,
USR_REGISTRO VARCHAR(50) NOT NULL,
FEC_REGISTRO DATE NOT NULL
);

CREATE TABLE PERMISOS(
COD_PERMISO INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
NOMBRE NOT NULL
);

CREATE TABLE ESTADO(
COD_ESTADO INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, 
DESCRIPCION VARCHAR(20) NOT NULL
);

CREATE TABLE USUARIO(
COD_USUARIO INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
COD_PERSONA INT NOT NULL,
COD_ESTADO INT NOT NULL,
USUARIO VARCHAR(50) NOT NULL,
CONTRASENA VARCHAR(100) NOT NULL,
PRIMER_INGRESO BOOLEAN DEFAULT FALSE,
TFA BOOLEAN DEFAULT FALSE,
SECRET VARCHAR(50),
QR TEXT,
USR_REGISTRO VARCHAR(50) NOT NULL,
FEC_REGISTRO DATE NOT NULL,
	
	CONSTRAINT FK_USUARIO_PERSONA FOREIGN KEY(COD_PERSONA)
	REFERENCES PERSONA(COD_PERSONA),
	
	CONSTRAINT FK_USUARIO_ESTADO FOREIGN KEY (COD_ESTADO)
	REFERENCES ESTADO(COD_ESTADO)
);

CREATE TABLE USUARIO_ROLES(
COD_USUARIO INT NOT NULL,
COD_ROL INT NOT NULL,
USR_REGISTRO VARCHAR(50) NOT NULL,
FEC_REGISTRO NOT NULL
	
	PRIMARY KEY(COD_USUARIO,COD_ROL),
	
	CONSTRAINT FK_USUARIO_ROLES_ROLES FOREIGN KEY(COD_ROL)
	REFERENCES ROLES(COD_ROL),
	
	
	CONSTRAINT FK_USUARIO_ROLES_USUARIO FOREIGN KEY(COD_USUARIO)
	REFERENCES USUARIO(COD_USUARIO)
	
);

CREATE TABLE PERMISO_PANTALLA_ROL(
COD_PAN_ROL INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
COD_PANTALLA INT NOT NULL,
COD_PERMISO INT NOT NULL,
COD_ROL INT NOT NULL,
ESTADO BOOLEAN,
USR_REGISTRO VARCHAR(50) NOT NULL,
FEC_REGISTRO DATE NOT NULL
	
	CONSTRAINT FK_PERMISO_PANTALLA_ROL_PANTALLAS FOREIGN KEY(COD_PANTALLA)
	REFERENCES PANTALLAS(COD_PANTALLA),
	
	CONSTRAINT FK_PERMISO_PANTALLA_ROL_PERMISOS FOREIGN KEY(COD_PERMISO)
	REFERENCES PERMISOS(COD_PERMISO),
	
	CONSTRAINT FK_PERMISO_PANTALLA_ROL_ROLES FOREIGN KEY(COD_ROL)
	REFERENCES ROLES(COD_ROL)

);

CREATE TABLE HISTORIAL_CONTRASENA(
COD_HIST INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
COD_USUARIO INT NOT NULL,
CONTRASENA VARCHAR(100) NOT NULL,
USR_REGISTRO VARCHAR(50)NOT NULL,
FEC_REGISTRO DATE NOT NULL	
);

