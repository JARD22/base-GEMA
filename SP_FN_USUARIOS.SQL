--PROCEDIMIENTO Y FUNCIONES USUARIOS


SELECT * FROM FN_LISTA_USUARIOS(0)
CREATE OR REPLACE FUNCTION FN_LISTA_USUARIOS(IN_OFFSET INT)RETURNS TABLE(OUT_ID INT,OUT_NOMBRE TEXT,OUT_ROL VARCHAR,ESTADO VARCHAR )
AS
$$
BEGIN

RETURN QUERY
SELECT USUARIO.COD_USUARIO,CONCAT(PERSONA.PRIMER_NOMBRE,' ',PERSONA.PRIMER_APELLIDO),ROLES.NOMBRE,ESTADO.DESCRIPCION
FROM USUARIO
INNER JOIN ESTADO ON USUARIO.COD_ESTADO= ESTADO.COD_ESTADO
INNER JOIN PERSONA ON USUARIO.COD_PERSONA = PERSONA.COD_PERSONA
INNER JOIN USUARIO_ROLES ON USUARIO.COD_USUARIO =USUARIO_ROLES.COD_USUARIO
INNER JOIN ROLES ON USUARIO_ROLES.COD_ROL =ROLES.COD_ROL
OFFSET IN_OFFSET
LIMIT 8;
END;
$$
LANGUAGE PLPGSQL;